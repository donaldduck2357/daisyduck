<!DOCTYPE html>
<html lang="en">
<head>
  <script>
    const password = "letmein";
    const entered = prompt("Enter password to access:");
  
    if (entered !== password) {
      document.body.innerHTML = "<h2>Access denied</h2>";
      throw new Error("Unauthorized access");
    }
  </script>  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flashcard App</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 2rem;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    select, .firm-filters {
      margin: 0.5rem;
    }
    .firm-filters label {
      margin-right: 0.5rem;
    }
    .grid {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .card {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
    }
    .card img {
      width: 100%;
      max-width: 1000px;
      height: auto;
      border-radius: 6px;
    }
    .card h4 {
      margin-top: 0.5rem;
      font-size: 1.2rem;
    }
    .card button {
      margin: 0.25rem;
    }
    #progressSummary {
      font-size: 0.9rem;
      color: #444;
    }

    @media (max-width: 600px) {
      .filters {
        flex-direction: column;
        gap: 0.5rem;
      }

      .firm-filters {
        display: flex;
        flex-wrap: wrap;
        max-height: 150px;
        overflow-y: auto;
      }

      .card img {
        width: 100%;
        height: auto;
      }

      .card {
        padding: 0.5rem;
      }

      .card button {
        font-size: 0.8rem;
        padding: 0.3rem 0.6rem;
      }

      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      #progressSummary {
        align-self: flex-end;
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Flashcard App</h1>
    <div id="progressSummary"></div>
  </div>

  <div class="filters">
    <select id="topicFilter"></select>
    <select id="difficultyFilter"></select>
    <select id="progressFilter">
      <option value="">All Progress</option>
      <option value="unanswered">Unanswered</option>
      <option value="incorrect">Incorrect</option>
      <option value="correct">Correct</option>
    </select>
    <div class="firm-filters" id="firmFilters"></div>
  </div>

  <div class="grid" id="cardGrid"></div>

  <script>
    let cards = [];
    let filteredCards = [];
    let progress = {};
    let showingAnswers = {};

    async function loadCards() {
      const res = await fetch('questions_metadata.json');
      cards = await res.json();
      populateFilters();
      loadProgress();
      applyFilters();
    }

    function loadProgress() {
      const stored = localStorage.getItem('flashcardProgress');
      if (stored) progress = JSON.parse(stored);
    }

    function saveProgress() {
      localStorage.setItem('flashcardProgress', JSON.stringify(progress));
    }

    function populateFilters() {
      const topics = [...new Set(cards.map(c => c.topic))];
      const difficulties = [...new Set(cards.map(c => c.difficulty))];
      const firms = [...new Set(cards.flatMap(c => c.firms))].filter(f => f);

      document.getElementById('topicFilter').innerHTML = `<option value="">All Topics</option>` + topics.map(t => `<option>${t}</option>`).join('');
      document.getElementById('difficultyFilter').innerHTML = `<option value="">All Difficulties</option>` + difficulties.map(d => `<option>${d}</option>`).join('');
      document.getElementById('firmFilters').innerHTML = firms.map(f => `
        <label><input type="checkbox" value="${f}" onchange="applyFilters()"> ${f}</label>
      `).join('');

      document.getElementById('topicFilter').onchange = applyFilters;
      document.getElementById('difficultyFilter').onchange = applyFilters;
      document.getElementById('progressFilter').onchange = applyFilters;
    }

    function applyFilters() {
      const topic = document.getElementById('topicFilter').value;
      const difficulty = document.getElementById('difficultyFilter').value;
      const progressFilter = document.getElementById('progressFilter').value;
      const selectedFirms = [...document.querySelectorAll('#firmFilters input:checked')].map(cb => cb.value);

      filteredCards = cards.filter(c => {
        const status = progress[c.filename];
        const matchesTopic = !topic || c.topic === topic;
        const matchesDifficulty = !difficulty || c.difficulty === difficulty;
        const matchesFirms = selectedFirms.length === 0 || selectedFirms.some(f => c.firms.includes(f));
        const matchesProgress = !progressFilter ||
          (progressFilter === 'unanswered' && status === undefined) ||
          (progressFilter === 'incorrect' && status === false) ||
          (progressFilter === 'correct' && status === true);

        return matchesTopic && matchesDifficulty && matchesFirms && matchesProgress;
      });

      renderCards();
    }

    function toggleAnswer(name) {
      showingAnswers[name] = !showingAnswers[name];
      renderCards();
    }

    function markCorrect(name) {
      progress[name] = true;
      saveProgress();
      renderCards();
    }

    function markIncorrect(name) {
      progress[name] = false;
      saveProgress();
      renderCards();
    }

    function resetCard(name) {
      delete progress[name];
      saveProgress();
      renderCards();
    }

    function renderCards() {
      const grid = document.getElementById('cardGrid');
      grid.innerHTML = '';

      filteredCards.forEach(card => {
        const isAnswer = showingAnswers[card.filename];
        const status = progress[card.filename];

        const div = document.createElement('div');
        div.className = 'card';

        div.innerHTML = `
          <img src="${isAnswer ? 'answers/' + encodeURIComponent(card.filename) : 'questions/' + encodeURIComponent(card.filename)}" alt="${card.name}" />
          <h4>${card.name}</h4>
          <div style="margin: 0.5rem 0; font-size: 0.9rem; color: #666;">
            Topic: <strong>${card.topic}</strong> | Difficulty: <strong>${card.difficulty}</strong>
          </div>
          <div>
            <button onclick="toggleAnswer('${card.filename}')">${isAnswer ? 'Hide Answer' : 'Show Answer'}</button>
            <button onclick="markCorrect('${card.filename}')">‚úîÔ∏è</button>
            <button onclick="markIncorrect('${card.filename}')">‚ùå</button>
            <button onclick="resetCard('${card.filename}')">üîÅ Reset</button>
          </div>
          <div>${status === true ? '‚úîÔ∏è Correct' : status === false ? '‚ùå Incorrect' : 'Not answered'}</div>
        `;

        grid.appendChild(div);
      });

      const totalFiltered = filteredCards.length;
      const answeredFiltered = filteredCards.filter(c => progress[c.filename] !== undefined).length;
      document.getElementById('progressSummary').textContent = `${answeredFiltered} of ${totalFiltered} answered`;
    }

    loadCards();
  </script>
</body>
</html>
